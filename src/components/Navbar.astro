---
import ImageComp from "./ImageComp.astro";
import { IoIosAirplane } from "react-icons/io";
import { LOGO_ASSETS, LOGO_ASSETS_2 } from "../data/consts";
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import { LINKEDIN_URL } from "../data/consts";
import { INSTAGRAM_URL } from "../data/consts";
import { X_URL } from "../data/consts";
import { FACEBOOK_URL } from "../data/consts";

type Program = CollectionEntry<"programs">;

const programs = await getCollection("programs");
const sortedPrograms = programs.sort(
  (a: Program, b: Program) => (a.data.order || 999) - (b.data.order || 999)
);

export type MenuItem = {
  label: string;
  url: string;
  children?: MenuItem[];
};

export type NavbarButton = {
  text: string;
  href: string;
  style: string;
};

export const menu: MenuItem[] = [
  {
    label: "New to Flying?",
    url: "/new-to-flying",
    children: [
      { label: "Why become a pilot", url: "/new-to-flying" },
      { label: "Discovery Flights", url: "/discovery-flight" },
    ],
  },
  {
    label: "Resources",
    url: "/resources/student-resources",
    children: [
      { label: "Student Resources", url: "/resources/student-resources" },
      {
        label: "Liberty University Aviation Degree",
        url: "/about/liberty-university",
      },
      // {
      //   label: "DOD SkillBridge",
      //   url: "/about/breakturn",
      // },
      {
        label: "Flight Schedule Pro",
        url: "https://app.flightschedulepro.com/Account/Login?company=143387",
      },
      // {
      //   label: "Flight Review",
      //   url: "/programs/flight-review",
      // },
    ],
  },
  {
    label: "About",
    url: "/about",
    children: [
      { label: "About Eagle Aircraft", url: "/about" },
      {
        label: "iFly Aviation Partnership",
        url: "/about/eagle-aircraft-ifly-aviation-partnership",
      },
      { label: "Our Crew", url: "/crew" },
      { label: "Our Fleet", url: "/aircraft" },
      // { label: "Financing", url: "/financing" },
      // { label: "Our partners", url: "/partners/" },
      // { label: "Funding Options", url: "/funding-options" },
      // { label: "Partners", url: "/partners/" },
      { label: "FAQ", url: "/about/faq" },
      { label: "Blog", url: "/blog" },
      { label: "Contact Us", url: "/about/contact" },
      { label: "Enrollment", url: "/enrollment" },
    ],
  },
];

export const footerMenu: MenuItem[] = [
  {
    label: "About",
    url: "/about",
    children: [
      { label: "About Eagle Aircraft", url: "/about" },
      { label: "Our Crew", url: "/crew" },
      { label: "Our Fleet", url: "/aircraft" },
      { label: "Liberty University", url: "/about/liberty-university" },
      { label: "BreakTurn", url: "/about/breakturn" },
      // { label: "Funding Options", url: "/funding-options" },
      // { label: "Partners", url: "/partners/" },
      { label: "FAQ", url: "/about/faq" },
      { label: "Blog", url: "/blog" },
      { label: "Contact Us", url: "/about/contact" },
      { label: "Enrollment", url: "/enrollment" },
    ],
  },
];

const { pathname, navBarBG = false } = Astro.props;
---

<nav id="navbar" class="navbar font-subtitle">
  <div class="container px-4 md:px-0">
    <!-- Logo -->
    <a href="/" class="object-contain h-auto">
      <div class="logo-default">
        <ImageComp
            class="logo-muted-50 w-36 max-w-36 md:w-56 md:max-w-56 duration-200"
            src={LOGO_ASSETS}
            alt="Eagle Aircraft Logo"
            widths={[144, 224, 288]}
            sizes="(max-width: 768px) 144px, 224px"
            quality={60}
            loading="eager"
        />
      </div>

      <div class="logo-active hidden">
        <ImageComp
          class="logo-muted-50 w-16 max-w-16 md:w-26 md:max-w-26 duration-200"
          src={LOGO_ASSETS_2}
          alt="Eagle Aircraft Icon"
          widths={[64, 104]}
          sizes="(max-width: 768px) 64px, 104px"
          quality={60}
          loading="eager"
        />
      </div>
    </a>

    <!-- Desktop Menu -->
    <ul class="nav">
      {
        sortedPrograms && (
          <li
            class={`menu-item !text-black text-xl ${sortedPrograms.length >= 1 ? "has-children" : ""}`}
          >
            <a href="/programs">{sortedPrograms[0].collection}</a>
            {sortedPrograms.length >= 1 ? (
              <ul class="sub-menu text-lg">
                {sortedPrograms.map((program: Program) => (
                  <li>
                    <a
                      href={`/programs/${program.slug}`}
                      class={
                        (`/programs/${program.slug}` === pathname ||
                          `/programs/${program.slug}/` === pathname) &&
                        `/programs/${program.slug}` !== "/programs/"
                          ? "menu-link-hover"
                          : ""
                      }
                    >
                      {program.data.title}
                    </a>
                  </li>
                ))}
              </ul>
            ) : (
              ""
            )}
          </li>
        )
      }
      {
        menu.map((item, index) => (
          <li
            class={`menu-item  text-xl px-4 ${item.children ? "has-children" : ""}`}
            data-index={index}
          >
            <a
              href={item.url}
              target={item.url.includes("http") ? "_blank" : ""}
            >
              {item.label}
            </a>
            {item.children && (
              <ul class="sub-menu text-lg">
                {item.children.map((child) => (
                  <li>
                    <a
                      href={child.url}
                      target={child.url.includes("http") ? "_blank" : ""}
                      class={
                        (child.url === pathname ||
                          child.url + "/" === pathname) &&
                        child.url !== "/"
                          ? "menu-link-hover"
                          : ""
                      }
                    >
                      {child.label}
                    </a>
                  </li>
                ))}
              </ul>
            )}
          </li>
        ))
      }
    </ul>

    <!-- Buttons -->
    <div class="buttons">
      <a href="/about/contact" class="btn-secondary text-xl! shadow-xl!">
        <IoIosAirplane className="size-6" />
        Contact Us
      </a>
    </div>

    <!-- Mobile Hamburger -->
    <button id="mobile-toggle" class="hamburger" aria-label="Toggle menu">
      <svg
        class="hamburger-menu-bars"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <line x1="3" x2="21" y1="6" y2="6"></line>
        <line x1="3" x2="21" y1="12" y2="12"></line>
        <line x1="3" x2="21" y1="18" y2="18"></line>
      </svg>
      <svg
        class="hamburger-menu-x"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="M18 6 6 18"></path>
        <path d="m6 6 12 12"></path>
      </svg>
    </button>
  </div>

  <!-- Mobile Menu -->
  <div id="mobile-menu" class="mobile-menu w-full">
    <ul class="w-full mt-4 px-4">
      {
        sortedPrograms && (
          <li class="mobile-item border-b border-gray-100">
            <div class="flex items-center justify-between">
              <a href="/programs" class="flex-grow py-3 text-lg font-semibold">
                PROGRAMS
              </a>
              {sortedPrograms.length >= 1 && (
                <button
                  class="mobile-submenu-toggle p-3 text-xl focus:outline-none"
                  aria-label="Toggle submenu"
                >
                  ⟫
                </button>
              )}
            </div>

            {sortedPrograms.length >= 1 ? (
              <ul class="mobile-submenu">
                {sortedPrograms.map((program: Program) => (
                  <li>
                    <a
                      href={`/programs/${program.slug}`}
                      class={
                        (`/programs/${program.slug}` === pathname ||
                          `/programs/${program.slug}/` === pathname) &&
                        `/programs/${program.slug}` !== "/programs/"
                          ? "menu-link-hover"
                          : ""
                      }
                    >
                      {program.data.title.toUpperCase()}
                    </a>
                  </li>
                ))}
              </ul>
            ) : (
              ""
            )}
          </li>
        )
      }
      {
        menu.map((item, index) => (
          <li class="mobile-item border-b border-gray-100" data-index={index}>
            <div class="flex items-center justify-between">
              <a href={item.url} class="flex-grow py-3 text-lg font-semibold">
                {item.label.toUpperCase()}
              </a>
              {item.children && (
                <button
                  class="mobile-submenu-toggle p-3 text-xl focus:outline-none"
                  aria-label="Toggle submenu"
                >
                  ⟫
                </button>
              )}
            </div>

            {item.children && (
              <ul class="mobile-submenu">
                {item.children.map((child) => (
                  <li>
                    <a
                      href={child.url}
                      target={child.url.includes("http") ? "_blank" : ""}
                      class={
                        (child.url === pathname ||
                          child.url + "/" === pathname) &&
                        child.url !== "/"
                          ? "menu-link-hover"
                          : ""
                      }
                    >
                      {child.label.toUpperCase()}
                    </a>
                  </li>
                ))}
              </ul>
            )}
          </li>
        ))
      }
    </ul>

    <div class="mobile-buttons !border-t !border-gray-300">
      <a href="/about/contact" class="btn-primary text-lg! mt-4">
        <IoIosAirplane className="size-6" />
        Contact Us
      </a>
    </div>

    <div class="border-t border-gray-300 m-4 py-4">
      <div class="flex w-full justify-center gap-4">
        {/* ... seus ícones sociais ... */}
        {
          FACEBOOK_URL && (
            <a  aria-label="Link to Facebook profile"
              href={FACEBOOK_URL}
              target="_blank"
              class="text-monza-700 hover:text-monza-800"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="32"
                height="32"
                viewBox="0 0 24 24"
              >
                <path
                  fill="currentColor"
                  d="M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12c0 4.84 3.44 8.87 8 9.8V15H8v-3h2V9.5C10 7.57 11.57 6 13.5 6H16v3h-2c-.55 0-1 .45-1 1v2h3v3h-3v6.95c5.05-.5 9-4.76 9-9.95"
                />
              </svg>
            </a>
          )
        }
        {
          X_URL && (
            <a aria-label="Link to X (previously Twitter) profile"
              href={X_URL}
              target="_blank"
              class="text-monza-700 hover:text-monza-800"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="32"
                height="32"
                viewBox="0 0 24 24"
              >
                <path
                  fill="currentColor"
                  d="M18.205 2.25h3.308l-7.227 8.26l8.502 11.24H16.13l-5.214-6.817L4.95 21.75H1.64l7.73-8.835L1.215 2.25H8.04l4.713 6.231zm-1.161 17.52h1.833L7.045 4.126H5.078z"
                />
              </svg>
            </a>
          )
        }
        {
          INSTAGRAM_URL && (
            <a aria-label="Link to Instagram profile"
              href={INSTAGRAM_URL}
              target="_blank"
              class="text-monza-700 hover:text-monza-800"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="32"
                height="32"
                viewBox="0 0 24 24"
              >
                <path
                  fill="currentColor"
                  d="M12.001 9a3 3 0 1 0 0 6a3 3 0 0 0 0-6m0-2a5 5 0 1 1 0 10a5 5 0 0 1 0-10m6.5-.25a1.25 1.25 0 0 1-2.5 0a1.25 1.25 0 0 1 2.5 0M12.001 4c-2.474 0-2.878.007-4.029.058c-.784.037-1.31.142-1.798.332a2.9 2.9 0 0 0-1.08.703a2.9 2.9 0 0 0-.704 1.08c-.19.49-.295 1.015-.331 1.798C4.007 9.075 4 9.461 4 12c0 2.475.007 2.878.058 4.029c.037.783.142 1.31.331 1.797c.17.435.37.748.702 1.08c.337.336.65.537 1.08.703c.494.191 1.02.297 1.8.333C9.075 19.994 9.461 20 12 20c2.475 0 2.878-.007 4.029-.058c.782-.037 1.308-.142 1.797-.331a2.9 2.9 0 0 0 1.08-.703c.337-.336.538-.649.704-1.08c.19-.492.296-1.018.332-1.8c.052-1.103.058-1.49.058-4.028c0-2.474-.007-2.878-.058-4.029c-.037-.782-.143-1.31-.332-1.798a2.9 2.9 0 0 0-.703-1.08a2.9 2.9 0 0 0-1.08-.704c-.49-.19-1.016-.295-1.798-.331C14.926 4.006 14.54 4 12 4m0-2c2.717 0 3.056.01 4.123.06c1.064.05 1.79.217 2.427.465c.66.254 1.216.598 1.772 1.153a4.9 4.9 0 0 1 1.153 1.772c.247.637.415 1.363.465 2.428c.047 1.066.06 1.405.06 4.122s-.01 3.056-.06 4.122s-.218 1.79-.465 2.428a4.9 4.9 0 0 1-1.153 1.772a4.9 4.9 0 0 1-1.772 1.153c-.637.247-1.363.415-2.427.465c-1.067.047-1.406.06-4.123.06s-3.056-.01-4.123-.06c-1.064-.05-1.789-.218-2.427-.465a4.9 4.9 0 0 1-1.772-1.153a4.9 4.9 0 0 1-1.153-1.772c-.248-.637-.415-1.363-.465-2.428C2.012 15.056 2 14.717 2 12s.01-3.056.06-4.122s.217-1.79.465-2.428a4.9 4.9 0 0 1 1.153-1.772A4.9 4.9 0 0 1 5.45 2.525c.637-.248 1.362-.415 2.427-.465C8.945 2.013 9.284 2 12.001 2"
                />
              </svg>
            </a>
          )
        }
        {
          LINKEDIN_URL && (
            <a aria-label="Link to Linkedin profile"
              href={LINKEDIN_URL}
              target="_blank"
              class="text-monza-700 hover:text-monza-800"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="32"
                height="32"
                viewBox="0 0 24 24"
              >
                <path
                  fill="currentColor"
                  d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2zm-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93zM6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37z"
                />
              </svg>
            </a>
          )
        }
      </div>
    </div>
  </div>
</nav>

<style>
  .navbar {
    position: relative;
    z-index: 50;
    width: 100%;
    display: flex;
    justify-content: center;
    transition: all 0.5s ease;
    padding: 16px 16px;
    background-color: white;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
  }

  .container {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  /* .navbar.scrolled,
  .navbar.force-navbar-bg {
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(8px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
  } */

  .nav {
    display: flex;
    gap: 0.75rem;
    list-style: none;
  }

  /* .navbar .menu-item {
    opacity: 0;
    pointer-events: none;
  } */

  .logo-active {
    display: none;
  }

  .container.open .logo-default {
    display: none;
  }

  .container.open .logo-active {
    display: block;
  }

  .navbar.scrolled .menu-item,
  .navbar.force-navbar-bg .menu-item {
    opacity: 1;
    pointer-events: unset;
  }

  .menu-item {
    position: relative;
    transition: color 0.3s ease;
  }

  .menu-item a {
    font-weight: 500;
    text-transform: uppercase;
    transition: all 0.3s ease;
    color: #101828;
  }

  .menu-item a:hover,
  .menu-item a:has(+ ul > li > a.menu-link-hover) {
    color: #e61c24;
  }

  .navbar.scrolled .sub-menu li a:hover,
  .navbar.scrolled .sub-menu li a.menu-link-hover,
  .navbar.force-navbar-bg .sub-menu li a:hover,
  .navbar.force-navbar-bg .sub-menu li a.menu-link-hover {
    background: #e61c24;
  }

  .navbar.scrolled .nav > .menu-item > a,
  .navbar.force-navbar-bg .nav > .menu-item > a {
    color: #101828; /* accent-900 */
  }

  .navbar.scrolled .nav > .menu-item > a:hover,
  .navbar.scrolled .nav > .menu-item > a.menu-link-hover,
  .navbar.scrolled .nav > .menu-item a:has(+ ul > li > a.menu-link-hover),
  .navbar.force-navbar-bg .nav > .menu-item > a:hover,
  .navbar.force-navbar-bg .nav > .menu-item > a.menu-link-hover,
  .navbar.force-navbar-bg
    .nav
    > .menu-item
    a:has(+ ul > li > a.menu-link-hover) {
    color: #e61c24;
  }

  .navbar.scrolled .sub-menu li a.menu-link-hover,
  .navbar.force-navbar-bg .sub-menu li a.menu-link-hover {
    background: #e61c24;
  }

  /* Dropdown (desktop) */
  .sub-menu {
    position: absolute;
    top: 100%;
    left: 0;
    z-index: 40;
    min-width: 220px;

    background: #fff;
    border: 1px solid #ddd;
    list-style: none;
    padding: 0.5rem 0;
    border-radius: 0.25rem;

    /* no display:none — use visibility + opacity to avoid hover gaps */
    visibility: hidden;
    opacity: 0;
    transform: translateY(6px);
    pointer-events: none;

    /* 0.3s transition as requested */
    transition:
      opacity 0.3s ease,
      transform 0.3s ease,
      visibility 0.3s step-end; /* hide clicks when closed */
  }

  /* Show on hover */
  .menu-item:hover .sub-menu {
    visibility: visible;
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
    transition:
      opacity 0.3s ease,
      transform 0.3s ease,
      visibility 0.3s step-start; /* become clickable immediately */
  }

  /* Small invisible “bridge” to prevent hover loss between item and submenu */
  .menu-item {
    position: relative;
  }
  .menu-item::after {
    content: "";
    position: absolute;
    left: 0;
    right: 0;
    top: 100%;
    height: 10px; /* adjust if you like */
    background: transparent;
  }

  /* Dropdown items */
  .sub-menu li a {
    display: block;
    padding: 0.5rem 1rem;
    white-space: nowrap;
    color: #393d40;
    transition:
      background 0.3s ease,
      color 0.3s ease,
      transform 0.3s ease;
    position: relative;
  }

  .sub-menu li a:before {
    content: " ";
    display: block;
    height: 100%;
    width: 0%;
    position: absolute;
    inset: 0;
    z-index: -1;
    background: #ffa0a4;
    transition: all 450ms ease-out;
  }

  .sub-menu li a:hover,
  .sub-menu li a.menu-link-hover {
    color: #fff;
    background: #e61c24;
  }

  .sub-menu li a:hover:before,
  .sub-menu li a.menu-link-hover:before {
    width: 100%;
  }

  .container .hamburger .hamburger-menu-x,
  .container.open .hamburger .hamburger-menu-bars {
    display: none;
  }

  .container.open .hamburger .hamburger-menu-x,
  .container .hamburger .hamburger-menu-bars {
    display: block;
  }

  .hamburger {
    display: none;
    flex-direction: column;
    gap: 4px;
    background: none;
    border: none;
    cursor: pointer;
    color: #101828; /* accent-900 */
  }

  /* Mobile sheet (base) */
  .mobile-menu {
    position: absolute;
    width: 100%;
    height: 100vh;
    top: 100%;
    left: 0;
    width: 100%;
    background: white;
    padding: 0 1rem;
    max-height: 0;
    overflow: hidden;
    transition: all 0.5s ease;
  }
  .mobile-menu.open {
    padding-top: 1rem;
    padding-bottom: 1rem;
    max-height: 100vh;
    overflow: visible;
  }

  /* Mobile submenu animation (base) */
  .mobile-submenu {
    max-height: 0;
    overflow: hidden;
    transition:
      max-height 0.5s ease,
      opacity 0.3s ease;
    opacity: 0;
  }
  .mobile-submenu.open {
    max-height: 20rem;
    opacity: 1;
  }

  @media (min-width: 1024px) {
    .container.open .logo-default {
      display: block;
    }
    .container.open .logo-active {
      display: none;
    }
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  /* ===== MOBILE-ONLY CHANGES BELOW ===== */
  @media (max-width: 1023px) {
    .navbar,
    .navbar.scrolled {
      background: white;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
    }

    .nav,
    .buttons {
      display: none;
    }
    .hamburger {
      display: flex;
    }

    /* Closed state: no vertical padding, zero height */
    .mobile-menu {
      padding: 0 16px;
    }

    /* Open state: add vertical padding + usable height */
    .mobile-menu.open {
      padding-top: 12px;
      padding-bottom: 14px;
      max-height: calc(100vh - 64px);
      overflow: auto;
    }

    /* Parent rows: larger tap targets + right chevron */
    .mobile-item > a {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 4px;
      font-weight: 600;
      color: #101828; /* accent-900 */
    }
    /* .mobile-item > a::after {
      content: "⟫";
      margin-left: 0.5rem;
      transition: transform 0.25s ease;
    }
    .mobile-item > a.open::after {
      transform: rotate(90deg);
    } */

    .mobile-submenu-toggle {
      transition: transform 0.3s ease;
    }
    .mobile-submenu-toggle.open {
      transform: rotate(90deg);
    }

    /* Submenu styling */
    .mobile-submenu {
      border-left: 2px solid #101828; /* accent-900 */
      margin-left: 10px;
      padding-left: 6px;
    }
    a:has(+ .mobile-submenu.open),
    a:has(+ .mobile-submenu .menu-link-hover) {
      color: #e61c24; /* primary-400 */
    }
    .mobile-submenu li a {
      display: block;
      padding: 10px 12px 10px 24px;
      border-radius: 6px;
      color: #101828; /* accent-900 */
    }
    .mobile-submenu li a:hover {
      background: oklch(0.278 0.033 256.848); /* primary-400 */
      color: #f3f4f6;
      font-weight: bold;
    }

    .mobile-submenu li a.menu-link-hover {
      background: oklch(0.278 0.033 256.848); /* primary-400 */
      color: #f3f4f6;
      font-weight: bold;
    }

    /* Sticky full-width CTA */
    .mobile-buttons {
      background-color: white;
      position: sticky;
      bottom: 0;
      border-top: 1px solid #101828; /* accent-900 */
      margin-inline: 16px;
    }
    .mobile-buttons a {
      width: 100%;
      display: flex;
      text-align: center;
    }
  }

  @media screen and (min-width: 1280px) {
    .nav {
      gap: 2rem;
    }
  }
</style>

<script type="module">
  const navbar = document.getElementById("navbar");
  const mobileToggle = document.getElementById("mobile-toggle");
  const mobileMenu = document.getElementById("mobile-menu");
  const menuHeaderContainer = document.querySelector("#navbar > .container");
  const logoWhite = document.querySelector(".logo-white");

  function UpdateLogo() {
    if (
      ((window.scrollY > 40 || window.innerWidth <= 1023) &&
        !navbar.classList.contains("scrolled")) ||
      navbar.classList.contains("force-navbar-bg")
    ) {
      navbar.classList.add("scrolled");
      logoWhite?.classList.remove("md:w-56");
      logoWhite?.classList.add("md:w-44");

      return;
    }

    if (
      window.scrollY <= 40 &&
      window.innerWidth > 1023 &&
      navbar.classList.contains("scrolled")
    ) {
      navbar.classList.remove("scrolled");
      logoWhite?.classList.remove("md:w-44");
      logoWhite?.classList.add("md:w-56");
    }
  }

  let scrollDebounceTimer;
  let resizeDebounceTimer;

  window.addEventListener("scroll", () => {
    clearTimeout(scrollDebounceTimer);
    setTimeout(UpdateLogo, 200);
  });

  window.addEventListener("resize", () => {
    clearTimeout(resizeDebounceTimer);
    setTimeout(UpdateLogo, 200);
  });

  document.addEventListener("DOMContentLoaded", UpdateLogo);

  // 1. Mobile menu open/close (Hamburger)
  mobileToggle?.addEventListener("click", () => {
    mobileMenu?.classList.toggle("open");
    menuHeaderContainer?.classList.toggle("open");
    document.body.classList.toggle("overflow-hidden");
  });

  // 2. Mobile Submenu Toggles (The Arrows)
  const mobileItems = document.querySelectorAll(".mobile-item");

  mobileItems.forEach((item) => {
    // Select the button, not the link
    const toggleBtn = item.querySelector(".mobile-submenu-toggle");
    const submenu = item.querySelector(".mobile-submenu");

    if (submenu && toggleBtn) {
      toggleBtn.addEventListener("click", (e) => {
        e.preventDefault();

        const isOpen = submenu.classList.contains("open");

        // Close other open submenus (Accordion effect)
        document
          .querySelectorAll(".mobile-submenu.open")
          .forEach((openSubmenu) => {
            if (openSubmenu !== submenu) {
              openSubmenu.classList.remove("open");
              openSubmenu.style.maxHeight = "0px";
              openSubmenu.style.opacity = "0";

              // Reset the arrow rotation of the other menus
              const otherBtn = openSubmenu.parentElement.querySelector(
                ".mobile-submenu-toggle"
              );
              if (otherBtn) otherBtn.classList.remove("open");
            }
          });

        // Toggle current submenu
        submenu.classList.toggle("open", !isOpen);
        toggleBtn.classList.toggle("open", !isOpen);

        if (!isOpen) {
          submenu.style.maxHeight = submenu.scrollHeight + "px";
          submenu.style.opacity = "1";
        } else {
          submenu.style.maxHeight = "0px";
          submenu.style.opacity = "0";
        }
      });
    }
  });

  // 3. Regular Links (Navigation + Close Menu)
  // Since we separated the "Link" from the "Toggle", any click on an <a> tag
  // inside the mobile menu should simply close the menu and let the browser navigate.
  document.querySelectorAll("#mobile-menu a").forEach((link) => {
    link.addEventListener("click", (e) => {
      // Close mobile menu
      if (mobileMenu.classList.contains("open")) {
        mobileMenu.classList.remove("open");
        menuHeaderContainer?.classList.remove("open");
        document.body.classList.remove("overflow-hidden");
      }

      // Smooth scroll support for hash links (e.g., /#about)
      const href = link.getAttribute("href");
      if (href && href.includes("#")) {
        const targetId = href.split("#")[1];
        const targetEl = document.getElementById(targetId);
        if (targetEl) {
          setTimeout(() => {
            targetEl.scrollIntoView({ behavior: "smooth" });
          }, 150);
        }
      }
    });
  });
</script>
