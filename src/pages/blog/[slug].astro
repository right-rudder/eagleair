---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import type { GetStaticPaths } from "astro";
import ImageWithZoomEffect from "../../components/ImageWithZoomEffect.astro";
import BlogPostCard from "../../components/BlogPostCard.astro";
import HeroScreen from "../../components/HeroScreen2.astro";
import ImageComp from "../../components/ImageComp.astro";
import CTAEnrollWithUsMini from "../../components/CTAEnrollWithUsMini.astro";
import Hero75 from "../../components/Hero75.astro";
import { AIRPORT, AIRPORT_CODE, COMPANY_NAME, COMPANY_NICKNAME, LOCATION } from "../../data/consts";

export const getStaticPaths = (async () => {
  const blogPosts = await getCollection("blog");
  return blogPosts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}) satisfies GetStaticPaths;

const { post } = Astro.props;
const { Content } = await post.render();

const formatDate = (date: Date) => {
  return new Intl.DateTimeFormat("en-US", {
    year: "numeric",
    month: "long",
    day: "numeric",
  }).format(date);
};

const allPosts = await getCollection("blog");
const relatedPosts = post.data.tags
  ? allPosts
      .filter(
        (p) =>
          p.slug !== post.slug &&
          p.data.tags?.some((tag) => post.data.tags?.includes(tag))
      )
      .slice(0, 3)
  : [];
const eagleAirLogo = "/src/assets/logo_eagle_aircraft_round_color.png";

const heroData = {
  image: { src: "/src/assets/old website/background.jpg", alt: "Background" },
  upperHeader: "Latest Insights",
  title: `${post.data.title}`,
  subTitle: `${post.data.description}`,
  cta: [{ url: "#article", text: "Read More" }],
};

const metaTagsData = {
  siteTitle: `${post.data.title} | ${COMPANY_NAME} Blog`,
  siteDescription: `${post.data.description}`,
  siteKeywords: [
    `${post.data.title}`,
    `${post.data.tags?.join(", ")}`,
    `${COMPANY_NAME} blog`,
    `${COMPANY_NICKNAME} aviation news`,
    `flight training articles ${LOCATION.city}`,
    `pilot career advice ${LOCATION.state}`,
    `${AIRPORT} aviation insights`,
    `${AIRPORT_CODE} flight academy updates`,
    "how to become a pilot blog",
    "aviation training tips",
    "learn to fly indiana",
    "flight school student resources",
    "commercial pilot career blog",
    "airline pilot training insights",
    "cessna pilot center news",
    "FAA part 141 training blog",
    "private pilot certificate tips",
    "instrument rating guide",
    "multi-engine training blog",
    "certified flight instructor updates",
    "aviation industry news indiana",
    "porter county regional airport news",
    "northwest indiana flight training blog",
    "chicagoland aviation insights",
    "liberty university aviation partner blog",
    "veteran flight training news",
    "international student pilot articles",
    "pilot license requirements blog",
    "flight instructor career path",
    "aviation safety and training tips"
  ].join(", "),
};
---

<BaseLayout {...metaTagsData}>
  <Hero75 data={heroData} />

  <CTAEnrollWithUsMini />
  <article class="py-16 px-4 bg-muted-50 lg:bg-muted-100" id="article">
    <div class="w-full lg:max-w-6xl 2xl:max-w-7xl mx-auto">
      <div class="bg-muted-50 lg:shadow-lg p-8 lg:p-12 mb-8">
        {
          post.data.image && (
            <div class="mb-12 overflow-hidden">
              <ImageWithZoomEffect
                src={post.data.image}
                alt={post.data.title}
                class="w-full h-96 object-cover"
              />
            </div>
          )
        }
        <h1 class="title !text-4xl !text-madison-950 !mb-6">
          {post.data.title}
        </h1>
        <div class="flex items-center gap-3 text-sm text-black my-4">
          <ImageComp class="w-6" src={eagleAirLogo} alt="Eagle Aircraft logo" />
          <span>{post.data.author}</span>
          <span>|</span>
          <time datetime={post.data.pubDate.toISOString()}>
            {formatDate(post.data.pubDate)}
          </time>
        </div>

        {
          post.data.tags && post.data.tags.length > 0 && (
            <div class="flex flex-wrap gap-2 mb-8">
              {post.data.tags.map((tag) => (
                <span class="bg-monza-700 text-white text-sm px-4 py-2 rounded-full font-sans">
                  {tag}
                </span>
              ))}
            </div>
          )
        }

        <div class="prose prose-lg max-w-none text-black font-sans">
          <Content />
        </div>
      </div>

      <div
        class="bg-muted-50 border-t-1 border-monza-900 lg:border-t-0 lg:shadow-lg p-8 mb-8"
      >
        <h3 class="subtitle !mx-0 !text-madison-950 !mb-4">
          Share this article
        </h3>
        <div class="flex gap-4">
          <a
            href={`https://twitter.com/intent/tweet?text=${encodeURIComponent(post.data.title)}&url=${encodeURIComponent(Astro.url.toString())}`}
            target="_blank"
            rel="noopener noreferrer"
            class="btn-primary"
          >
            Twitter
          </a>
          <a
            href={`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(Astro.url.toString())}`}
            target="_blank"
            rel="noopener noreferrer"
            class="btn-primary"
          >
            Facebook
          </a>
          <a
            href={`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(Astro.url.toString())}`}
            target="_blank"
            rel="noopener noreferrer"
            class="btn-primary"
          >
            LinkedIn
          </a>
        </div>
      </div>
    </div>
  </article>
  <section class="bg-monza-800 p-8">
    <div class="max-w-7xl mx-auto flex flex-col space-y-4">
      {
        relatedPosts.length > 0 && (
          <div class="flex flex-col">
            <p class="mx-auto subtitle !text-white">Read More</p>
            <h2 class="title !text-muted-50 !mb-8 text-center">
              Related Articles
            </h2>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
              {relatedPosts.map((relatedPost) => (
                <BlogPostCard post={relatedPost} />
              ))}
            </div>
          </div>
        )
      }

      <div class="mt-12 text-center">
        <a href="/blog" class="btn-tertiary inline-block"> Back to Blog </a>
      </div>
    </div>
  </section>
</BaseLayout>
