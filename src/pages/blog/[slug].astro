---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import type { GetStaticPaths } from "astro";
import ImageWithZoomEffect from "../../components/ImageWithZoomEffect.astro";
import BlogPostCard from "../../components/BlogPostCard.astro";
import HeroScreen from "../../components/HeroScreen2.astro";
import ImageComp from "../../components/ImageComp.astro";
import CTAEnrollWithUsMini from "../../components/CTAEnrollWithUsMini.astro";

export const getStaticPaths = (async () => {
  const blogPosts = await getCollection("blog");
  return blogPosts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}) satisfies GetStaticPaths;

const { post } = Astro.props;
const { Content } = await post.render();

const formatDate = (date: Date) => {
  return new Intl.DateTimeFormat("en-US", {
    year: "numeric",
    month: "long",
    day: "numeric",
  }).format(date);
};

const allPosts = await getCollection("blog");
const relatedPosts = post.data.tags
  ? allPosts
      .filter(
        (p) =>
          p.slug !== post.slug &&
          p.data.tags?.some((tag) => post.data.tags?.includes(tag))
      )
      .slice(0, 3)
  : [];
const eagleAirLogo = "/src/assets/logo_eagle_aircraft_round_color.png";

const heroData = {
  image: {
    src: "/src/assets/angry-_-kat-5R4fBlHEegc-unsplash.jpg",
    alt: "Military aircraft in flight",
  },
  upperHeader: `Flying is Freedom`,
  title: "From First Flight <br> to Certified Pilot <br> All in One Academy",
  subTitle:
    "Accelerated FAA Part 141 pilot training designed for future commercial and airline pilots",
  cta: [
    { url: "#", text: "Private Pilot (PPL)" },
  ],
  stats: [
    { value: "1,500", suffix: "+", title: "Pilots Trained" },
    { value: "95", suffix: "%", title: "Checkride Pass Rate" },
    { value: "12", suffix: "+", title: "Training Aircraft" },
  ],
};
---

<BaseLayout
  siteTitle={`${post.data.title} | Eagle Aircraft Aviation Academy Blog`}
  siteDescription={post.data.description}
  siteImage={post.data.image}
>
  <HeroScreen data={heroData} />
  <CTAEnrollWithUsMini></CTAEnrollWithUsMini>
  <article class="py-16 px-4 bg-muted-50">
    <div class="max-w-5xl mx-auto">

      <div class="bg-white shadow-lg p-8 lg:p-12 mb-8">
      {post.data.image && (
        <div class="mb-12 overflow-hidden">
          <ImageWithZoomEffect
            src={post.data.image}
            alt={post.data.title}
            class="w-full h-96 object-cover"
          />
        </div>
      )}
        <h1 class="title !text-4xl !text-black !mb-6">{post.data.title}</h1>
        <div class="flex items-center gap-3 text-sm text-madison-900/90 mb-3">
              <ImageComp
              class="w-6"
              src={eagleAirLogo}
              alt="Eagle Air logo"/>
              <span >{post.data.author}</span>
              <span>|</span>
              <time datetime={post.data.pubDate.toISOString()}>
                {formatDate(post.data.pubDate)}
              </time>
            </div>

        {post.data.tags && post.data.tags.length > 0 && (
          <div class="flex flex-wrap gap-2 mb-8">
            {post.data.tags.map((tag) => (
              <span class="bg-madison-900/90 text-white text-sm px-4 py-2 rounded-full font-sans">
                {tag}
              </span>
            ))}
          </div>
        )}

        <div class="prose prose-lg max-w-none text-muted-900 font-sans">
          <Content />
        </div>
      </div>

      <div class="bg-white shadow-lg p-8 mb-8">
        <h3 class="subtitle !text-madison-950 !mb-4">Share this article</h3>
        <div class="flex gap-4">
          <a
            href={`https://twitter.com/intent/tweet?text=${encodeURIComponent(post.data.title)}&url=${encodeURIComponent(Astro.url.toString())}`}
            target="_blank"
            rel="noopener noreferrer"
            class="btn-primary"
          >
            Twitter
          </a>
          <a
            href={`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(Astro.url.toString())}`}
            target="_blank"
            rel="noopener noreferrer"
            class="btn-primary"
          >
            Facebook
          </a>
          <a
            href={`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(Astro.url.toString())}`}
            target="_blank"
            rel="noopener noreferrer"
            class="btn-primary"
          >
            LinkedIn
          </a>
        </div>
      </div>
    </div>
  </article>
  <section class="bg-monza-900 p-8">
    <div class="max-w-7xl mx-auto flex flex-col space-y-4">
      {relatedPosts.length > 0 && (
    <div class="flex flex-col">
      <p class="mx-auto subtitle !text-white">Read More</p>
      <h2 class="title !text-muted-50 !mb-8 text-center">Related Articles</h2>
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        {relatedPosts.map((relatedPost) => (
          <BlogPostCard post={relatedPost} />
        ))}
      </div>
    </div>
  )}

  <div class="mt-12 text-center">
    <a href="/blog" class="btn-tertiary inline-block">
      Back to Blog
    </a>
  </div>
    </div>
  </section>
</BaseLayout>